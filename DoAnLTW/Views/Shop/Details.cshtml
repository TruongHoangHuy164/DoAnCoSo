@model DoAnLTW.Models.Product

@{
    ViewData["Title"] = "Chi tiết sản phẩm";
}

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<div class="container mt-5">
    <div class="row">
        <!-- Carousel hiển thị ảnh sản phẩm -->
        <div class="col-md-6">
            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                <!-- Carousel indicators -->
                <div class="carousel-indicators">
                    @for (int i = 0; i < Model.Images.Count; i++)
                    {
                        <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="@i" class="@(i == 0 ? "active" : "")" aria-current="@(i == 0 ? "true" : "false")" aria-label="Slide @(i + 1)"></button>
                    }
                </div>

                <!-- Carousel items -->
                <div class="carousel-inner">
                    @if (Model.Images != null && Model.Images.Any())
                    {
                        @for (int i = 0; i < Model.Images.Count; i++)
                        {
                            var image = Model.Images.ElementAt(i);
                            <div class="carousel-item @(i == 0 ? "active" : "")">
                                <img src="@image.ImageUrl" class="d-block w-100" alt="Hình ảnh sản phẩm @(i + 1)" style="object-fit: cover; height: 400px;">
                            </div>
                        }
                    }
                    else
                    {
                        <!-- Hình ảnh mặc định nếu không có ảnh -->
                        <div class="carousel-item active">
                            <img src="/img/default-product.jpg" class="d-block w-100" alt="Hình ảnh mặc định" style="object-fit: cover; height: 400px;">
                        </div>
                    }
                </div>

                <!-- Carousel controls -->
                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>

        <!-- Thông tin sản phẩm -->
        <div class="col-md-6">
            <h2>@Model.Name</h2>
            <p><strong>Thương hiệu:</strong> @Model.Brand?.Name</p>
            <p><strong>Danh mục:</strong> @Model.Category?.Name</p>
            <p><strong>Mô tả:</strong> @Model.Description</p>

            <!-- Kích thước và giá -->
            <h4>Kích thước và giá</h4>
            <ul>
                @foreach (var productSize in Model.ProductSizes)
                {
                    <li>
                        Kích thước: @productSize.Size.size - Giá: @productSize.Price.ToString("C", new System.Globalization.CultureInfo("vi-VN"))
                        (@(productSize.Stock > 0 ? $"{productSize.Stock} sản phẩm có sẵn" : "Hết hàng"))
                    </li>
                }
            </ul>

            <!-- Form thêm vào giỏ hàng -->
            <form asp-action="AddToCart" method="post" class="mt-3">
                <input type="hidden" name="productId" value="@Model.ProductId" />
                <div class="mb-3">
                    <label for="sizeId" class="form-label">Chọn kích thước:</label>
                    <select name="sizeId" id="sizeId" class="form-select" required>
                        @foreach (var productSize in Model.ProductSizes.Where(ps => ps.Stock > 0))
                        {
                            <option value="@productSize.SizeId">@productSize.Size.size</option>
                        }
                    </select>
                </div>
                <div class="mb-3">
                    <label for="quantity" class="form-label">Số lượng:</label>
                    <input type="number" name="quantity" id="quantity" class="form-control" min="1" value="1" required />
                </div>
                <button type="submit" class="btn btn-primary">Thêm vào giỏ hàng</button>
            </form>

            <!-- Nút thêm vào danh sách yêu thích -->
            <form asp-action="ToggleFavourite" method="post" class="mt-3">
                <input type="hidden" name="productId" value="@Model.ProductId" />
                <button type="submit" class="btn btn-outline-danger">
                    @if (ViewBag.FavouriteProducts != null && ViewBag.FavouriteProducts.Contains(Model.ProductId))
                    {
                        <span>Xóa khỏi yêu thích</span>
                    }
                    else
                    {
                        <span>Thêm vào yêu thích</span>
                    }
                </button>
            </form>

            <!-- Đánh giá sản phẩm -->
            <h4 class="mt-4">Đánh giá sản phẩm</h4>
            @if (Model.Reviews != null && Model.Reviews.Any())
            {
                foreach (var review in Model.Reviews)
                {
                    <div class="border p-3 mb-2">
                        <p><strong>Điểm:</strong> @review.Rating/5</p>
                        <p><strong>Bình luận:</strong> @review.Comment</p>
                        <p><strong>Ngày:</strong> @review.CreatedAt.ToString("dd/MM/yyyy")</p>
                    </div>
                }
            }
            else
            {
                <p>Chưa có đánh giá nào.</p>
            }

            <!-- Form thêm đánh giá -->
            <form asp-action="AddReview" method="post" class="mt-3">
                <input type="hidden" name="productId" value="@Model.ProductId" />
                <div class="mb-3">
                    <label for="rating" class="form-label">Điểm đánh giá (1-5):</label>
                    <input type="number" name="rating" id="rating" class="form-control" min="1" max="5" required />
                </div>
                <div class="mb-3">
                    <label for="comment" class="form-label">Bình luận:</label>
                    <textarea name="comment" id="comment" class="form-control" rows="4"></textarea>
                </div>
                <button type="submit" class="btn btn-success">Gửi đánh giá</button>
            </form>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>