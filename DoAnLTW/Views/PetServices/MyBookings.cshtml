@model IEnumerable<DoAnLTW.Models.PetService>
@{
    ViewData["Title"] = "Lịch đặt của tôi";
}

<div class="container py-5">
    <div class="row mb-4">
        <div class="col-md-8">
            <h2>Lịch đặt dịch vụ của tôi</h2>
        </div>
        <div class="col-md-4 text-right">
            <a asp-action="Index" class="btn btn-primary">
                <i class="fas fa-plus"></i> Đặt dịch vụ mới
            </a>
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @if (!Model.Any())
    {
        <div class="alert alert-info">
            Bạn chưa có lịch đặt dịch vụ nào. <a asp-action="Index">Đặt dịch vụ ngay</a> để chăm sóc thú cưng của bạn.
        </div>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th>Thú cưng</th>
                        <th>Dịch vụ</th>
                        <th>Ngày hẹn</th>
                        <th>Giờ hẹn</th>
                        <th>Trạng thái</th>
                        <th>Giá</th>
                        <th>Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                            <td>@item.Pet.Name</td>
                            <td>@item.Service.Name</td>
                            <td>@item.AppointmentDate.ToString("dd/MM/yyyy")</td>
                            <td>@item.AppointmentTime.ToString("HH:mm")</td>
                            <td>
                                @{
                                    string badgeClass = item.Status switch
                                    {
                                        PetServiceStatus.ChoXacNhan => "badge badge-warning",
                                        PetServiceStatus.DaXacNhan => "badge badge-primary",
                                        PetServiceStatus.DangThucHien => "badge badge-info",
                                        PetServiceStatus.HoanThanh => "badge badge-success",
                                        PetServiceStatus.DaHuy => "badge badge-danger",
                                        _ => "badge badge-secondary"
                                    };

                                    string statusText = item.Status switch
                                    {
                                        PetServiceStatus.ChoXacNhan => "Chờ xác nhận",
                                        PetServiceStatus.DaXacNhan => "Đã xác nhận",
                                        PetServiceStatus.DangThucHien => "Đang thực hiện",
                                        PetServiceStatus.HoanThanh => "Hoàn thành",
                                        PetServiceStatus.DaHuy => "Đã hủy",
                                        _ => "Không xác định"
                                    };
                                }
                                <span class="@badgeClass">@statusText</span>
                            </td>
                            <td>@item.Price.ToString("N0") VNĐ</td>
                            <td>
                                <div class="btn-group">
                                    <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-info">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    @if (item.Status == PetServiceStatus.ChoXacNhan || item.Status == PetServiceStatus.DaXacNhan)
                                    {
                                        <a asp-action="Cancel" asp-route-id="@item.Id" class="btn btn-sm btn-danger">
                                            <i class="fas fa-times"></i>
                                        </a>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
</div>